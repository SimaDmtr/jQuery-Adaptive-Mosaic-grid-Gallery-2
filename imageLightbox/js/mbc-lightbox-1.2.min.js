/*
* MBC image lightbox - jQuery plugin
* @version 1.2
* @copyright 2016, Nereo Costacurta [MadeByCambiamentico]
* @site: http://cambiamentico.altervista.org
*
* @license: GPLv3 (https://www.gnu.org/licenses/gpl.html)
* free for non-commercial use.
* for commercial use, a little donation is welcome.
*/
function imageLightbox(t,e){var n=0,o=0,i=0,a=$(),r=[],s=!1;options={},targetID=0;var l=this,d=function(){var t=document.body||document.documentElement,t=t.style;return""==t.WebkitTransition?"-webkit-":""==t.MozTransition?"-moz-":""==t.OTransition?"-o-":""==t.transition?"":!1},g=d()===!1?!1:!0,c=function(t,e,n){var o={},i=d();o[i+"transform"]="translateX("+e+")",o[i+"transition"]=i+"transform "+n+"s linear",t.css(o)},p="ontouchstart"in window,f=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,u=function(t){if(p)return!0;if(!f||"undefined"==typeof t||"undefined"==typeof t.pointerType)return!1;if("undefined"!=typeof t.MSPOINTER_TYPE_MOUSE){if(t.MSPOINTER_TYPE_MOUSE!=t.pointerType)return!0}else if("mouse"!=t.pointerType)return!0;return!1};this.setOptions=function(t){options=$.extend({selector:"imagelightbox",caption:"imagelightbox-text",specialitems:["imagelightbox-desc","imagelightbox-text"],allowedTypes:"png|jpg|jpeg|gif",animationSpeed:250,preloadNext:!0,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1,fillMode:3},t)},this.updateoptions=function(t){options=$.extend(options,t)},this.setGallery=function(t){r=t},"undefined"!=typeof e?(this.setOptions(e),this.setGallery(t)):"undefined"!=typeof t?this.setOptions(t):(ILB.create(),this.setOptions(ILB.opt)),this.setImage=function(){if(!a.length)return!0;var t=$(window).width(),e=$(window).height(),i=new Image,s=options.fillMode;if(3==s){var l=t*e/1e4;s=35>l?2:70>l?1:0}i.onload=function(){if(n=i.width,o=i.height,0==s&&(t*=.9,e*=.95),n>t||o>e){var l;l=2==s?e>o||t>n?1:Math.min(o/e,n/t):n/o>t/e?n/t:o/e,n/=l,o/=l}a.css({width:n+"px",height:o+"px",top:($(window).height()-o)/2+"px",left:($(window).width()-n)/2+"px"}),$("#"+options.caption).html(r[targetID].title)},i.src=a.attr("src")},this.loadImage=function(t){if(s)return!1;if(t="undefined"==typeof t?!1:"left"==t?1:-1,a.length){if(t!==!1&&(r.length<2||options.quitOnEnd===!0&&(1===t&&0==targetID||-1===t&&targetID==r.length-1)))return l.self.quitLightbox(),!1;var e={opacity:0};g?c(a,100*t-i+"px",options.animationSpeed/1e3):e.left=parseInt(a.css("left"))+100*t+"px",a.animate(e,options.animationSpeed,function(){l.removeImage()}),i=0}s=!0,options.onLoadStart!==!1&&options.onLoadStart(),setTimeout(function(){a=$('<img id="'+options.selector+'">').load(function(){a.appendTo("body"),l.setImage();var e={opacity:1};if(a.css("opacity",0),g)c(a,-100*t+"px",0),setTimeout(function(){c(a,"0px",options.animationSpeed/1e3)},50);else{var n=parseInt(a.css("left"));e.left=n+"px",a.css("left",n-100*t+"px")}if(a.animate(e,options.animationSpeed,function(){s=!1,options.onLoadEnd!==!1&&options.onLoadEnd()}),options.preloadNext){var o=targetID+1;0>o?o=r.length-1:o>=r.length&&(o=0),$("<img>").attr("src",r[o].src).load()}}).error(function(){options.onLoadEnd!==!1&&options.onLoadEnd()}).attr("src",r[targetID].src);var e=0,o=0,d=0;if(p||f)a.on("touchstart pointerdown MSPointerDown",function(t){return!u(t.originalEvent)||options.quitOnImgClick?!0:(g&&(d=parseInt(a.css("left"))),void(e=t.originalEvent.pageX||t.originalEvent.touches[0].pageX))}).on("touchmove pointermove MSPointerMove",function(t){return!u(t.originalEvent)||options.quitOnImgClick?!0:(t.preventDefault(),o=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,i=e-o,void(g?c(a,-i+"px",0):a.css("left",d-i+"px")))}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(t){return!u(t.originalEvent)||options.quitOnImgClick?!0:void(Math.abs(i)>50?(targetID+=0>i?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),l.loadImage(i>0?"right":"left")):g?c(a,"0px",options.animationSpeed/1e3):a.animate({left:d+"px"},options.animationSpeed/2))});else{var h=!1,m=0;a.mousedown(function(t){t.preventDefault(),h=!0,m=0,g&&(d=parseInt(a.css("left"))),e=t.originalEvent.pageX}).mousemove(function(t){return h?(o=t.originalEvent.pageX,i=e-o,m=Math.max(m,Math.abs(i)),void(g?c(a,-i+"px",0):a.css("left",d-i+"px"))):!0}).mouseup(function(t){if(!h)return!0;if(h=!1,Math.abs(i)>50)targetID+=0>i?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),l.loadImage(i>0?"right":"left");else{if(console.log(m),5>m){if(options.quitOnImgClick)return l.self.quitLightbox(),!1;var e=(t.pageX||t.originalEvent.pageX)-t.target.offsetLeft;if(n/3>e||e>2*n/3)return targetID+=n/2>e?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),l.loadImage(n/2>e?"left":"right"),!1}g?c(a,"0px",options.animationSpeed/1e3):a.animate({left:d+"px"},options.animationSpeed/2)}})}},options.animationSpeed+100)},this.removeImage=function(){return a.length?(a.remove(),void(a=$())):!1},this.quitLightbox=function(){return a.length?void a.animate({opacity:0},options.animationSpeed,function(){l.removeImage(),s=!1,options.onEnd!==!1&&options.onEnd()}):!1},this.addTrigger=function(t,e){return t.click(function(t){t.preventDefault(),options.onStart!==!1&&options.onStart(),targetID=e,l.loadImage()})},this.addToGallery=function(t){var e={src:t.attr("href"),title:t.attr("title")||t.data("title")||" "},n=r.push(e)-1;this.addTrigger(t,n)},$(function(){$(window).on("resize",l.setImage),options.quitOnDocClick&&$(document).on(p?"touchend":"click",function(t){a.length&&!$(t.target).is(a)&&-1===options.specialitems.indexOf(t.target.id)&&l.quitLightbox()}),options.enableKeyboard&&$(document).on("keyup",function(t){return a.length?(t.preventDefault(),27==t.keyCode&&l.quitLightbox(),void((37==t.keyCode||39==t.keyCode)&&(targetID+=37==t.keyCode?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),l.loadImage(37==t.keyCode?"left":"right")))):!0})})}var ILB=function(){var t={created:!1,overlay:{create:function(){$("body").append('<div id="imagelightbox-overlay"></div>')},on:function(){$("#imagelightbox-overlay").addClass("visible")},off:function(){$("#imagelightbox-overlay").removeClass("visible")}},loader:{create:function(){$("body").append('<div id="imagelightbox-loading"></div>')},on:function(){$("#imagelightbox-loading").addClass("visible")},off:function(){$("#imagelightbox-loading").removeClass("visible")}},closeButton:{create:function(){$("body").append('<div id="imagelightbox-x">&times;</div>')},on:function(){$("#imagelightbox-x").addClass("visible")},off:function(){$("#imagelightbox-x").removeClass("visible")}},caption:{create:function(t){$("body").append('<div id="imagelightbox-desc"><div id="imagelightbox-text"'+(t?' class="'+t+'"':"")+"></div></div>")},on:function(){""===$("#imagelightbox-text").html()?t.caption.off():$("#imagelightbox-desc").addClass("visible")},off:function(){$("#imagelightbox-desc").removeClass("visible")}},create:function(e){return this.created?!1:(this.created=!0,void $(function(){t.overlay.create(),t.loader.create(),t.caption.create(e),t.closeButton.create()}))},opt:{onStart:function(){t.overlay.on(),t.closeButton.on()},onEnd:function(){t.overlay.off(),t.closeButton.off(),t.caption.off(),t.loader.off()},onLoadStart:function(){t.loader.on(),t.caption.off()},onLoadEnd:function(){t.loader.off(),t.caption.on()}}};return t}();$.fn.imageLightbox=function(t){return this.each(function(){var e=$(this);e[0].lightbox=new imageLightbox(t),e.find("a").each(function(){e[0].lightbox.addToGallery($(this))})})};